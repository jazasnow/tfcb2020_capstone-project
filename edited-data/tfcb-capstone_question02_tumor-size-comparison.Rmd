---
title: "tfcb-capstone_question02_tumor-size-comparison"
author: "Jazmine Snow"
date: "12/14/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Question 2: Did the average size of the tumor change between the trip_neg tumors and the er_pos tumors?

### Setup for project
Below allows you to load all of the packages necessary for this project. If you do not have these packages installed, please use the install.packages() function beforehand. 
```{r}
library(tidyverse)

library(dplyr)

library(dbplyr)

library(ggplot2)
```

### Load file for project
Load the file that contains the information given for this project. In this case, it is a csv file. 
```{r}
# Created a new variable called "raw_data" that reads the csv file I created of the raw-data.
raw_data <- read.csv("tumor-location_edited-data_csv.csv", as.is = TRUE) %>%
# Had to change the id name because it adds a weird character to it, I believe that this is because it was originally an excel file.
  rename(id = `Ã¯..id`) %>%
  print()
```
For this file, I had already tidied the column names and the data beforehand to make it easier to use for analysis in R. 

### Remove any samples that do not have tumor size recorded
Not all of the samples had its tumor size recorded. Therefore, it is necessary to remove any data that does not have a numerical symbol in the size_cm column. 
```{r}
# I created a new variable called "num_data" that stands for numerical data and added the raw_data dataframe to this variable.
num_data <- raw_data %>%
# Filtered out any samples that did not have size information. 
  filter(!is.na(size_cm)) %>%
  print()
```
Above you can see that the id numbers 200-212 and 1025-1102 have been removed from this dataframe. 

### Separate the dataframe into er_pos and trip_n samples
Currently, the two different sample subtypes are mixed together in this dataframe "num_data". To compare between the two subtypes, I decided to create separate dataframes for the er_pos and trip_neg data. 
```{r}
# Created a separate variable for er_pos tumors (denoted by "1" in subtype column).
er_pos <- num_data %>%
# Filtered the data so that only the rows with er_pos tumors are in this dataframe.
  filter(subtype == 1) 

# Changed the subtype column to now have er_pos instead of "1".
er_pos$subtype <- "er_pos"
er_pos

# Created a separate variable for trip_neg tumors (denoted by a "3" in subtype column).
trip_neg <- num_data %>%
# Filtered the data so that only the rows with trip_neg tumors are in this dataframe.
  filter(subtype == 3)

# Changed the subtype column to now have trip_neg instead of "3".
trip_neg$subtype <- "trip_neg"
trip_neg


# Calculated the numer of samples in each subtype by counting the number of rows in each dataframe.
nrow(er_pos)
nrow(trip_neg)
```
For my data, there are 782 samples that are ER-positive and 229 samples that are triple-negative tumors. 

### Combined the two dataframes back into one dataframe
Now that I was able to change the labels for the tumor subtype, we need to combine the two dataframes back together to compare the data. 
```{r}
# Created a new variable called assigned_data that now has the subtype names in the column labelled subtype.
# Joined the two dataframes together with code generated with the help of https://www.statmethods.net/management/merging.html . Since they don't have any matching columns, I had to use rbind instead of join. 
assigned_data <- rbind(er_pos, trip_neg) %>%
# Used the arrange() function to have the samples ordered by increasing id number. Without this, all of the er_pos data would be above the trip_neg data. 
  arrange(id)

assigned_data
```
Now that the data is arranged the way that is most conducive for me, I can continue to the size analysis. 

### Calculate the average tumor size of each tumor subtype
To compare tumor size, I will calculate the average tumor size for each subtype as well as its standard deviation from the mean.  
```{r}
# Created a new variable called "size_stats" and added the assigned_data to it.
size_stats <- assigned_data %>%
# To observe difference in subtype, I grouped the data by its subtype.
  group_by(subtype) %>%
# I used the summarize function to create a new table that has the mean tumor size and the standard deviation of each tumor size subtype.
  summarize(mean_tumor_size = mean(size_cm), st.dev_tumor_size = sd(size_cm)) %>%
  print()
```
The average tumor size for ER-positive samples is 2.41 with a standard deviation of +- 1.30. The average tumor size for triple-negative samples is 2.65 with a standard deviation of +- 1.17. Just by looking at the data, it does not appear that there is a signficant change in tumor size between the two subtypes. 

### Graph tumor size data
To visualize this data, I decided to use a bar graph. I picked a bar graph because I think that it best represents the data derived from my analysis. 
```{r, fig.width=8, fig.height=6} 
size_stats %>%
# Made a graph using ggplot with subtype on the x axis, mean tumor size on the y avis, where the two different subtypes are also separated by color and fill of the bars.
  ggplot(aes(subtype, mean_tumor_size, color = subtype, fill = subtype)) +
# Used geom_col to make the bar plot since we are comparing two different variables. 
  geom_col() +
# Used the classic theme to have a plain white background for the graph.
  theme_classic() +
# Added error bars that have the standard deviation data represented. I also changed the width of the error bars to make them easier to see. 
  geom_errorbar(aes(ymin = mean_tumor_size - st.dev_tumor_size , ymax = mean_tumor_size + st.dev_tumor_size, width = 0.49)) +
# Added a title to this graph where ER+ stands for er_pos and TN stands for trip_neg tumors.
  ggtitle("Average Tumor Size for ER+ and TN") +
# Removed the x axis label since it was not necessary for this graph and added a label for the y axis.
  labs(x = NULL, y = "Average Tumor Size (cm)") +
# Increased the size of the text to have it better conform to proportional ink standards. Also hid the legend by having its position be "none" since it is already given on the x axis. 
  theme(axis.text = element_text(size = 20), axis.title = element_text(size = 22), plot.title = element_text(size = 24), legend.position = "none") +
  # Changed the x axis labels using the help of http://www.sthda.com/english/wiki/ggplot2-axis-ticks-a-guide-to-customize-tick-marks-and-labels
  scale_x_discrete(labels = c("er_pos" = "ER+", "trip_neg" = "TN")) +
# Changed the colors for color and fill from the default to having the er_pos samples in grey and the trip_neg samples in purple. This was just a personal choice.
  scale_fill_manual(values = c("grey34", "mediumorchid4")) +
  scale_color_manual(values = c("grey34", "mediumorchid4")) +
# Increased the y axis scale from 4 to 5 because the data was looking a little cramped.
  ylim(0,5) 
# Save the figure using ggsave 
  #ggsave("tfcb-capstone_question02_tumor-size-comparison_bar-graph-figure.jpg")
```






